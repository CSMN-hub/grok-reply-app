# --- Build stage ---
FROM node:20-alpine AS build
WORKDIR /app

# Web
COPY web/package*.json ./web/
RUN cd web && npm ci
COPY web ./web
RUN cd web && npm run build

# Server
COPY server/package*.json ./server/
RUN cd server && npm ci
COPY server ./server

# Move web dist into server/public
RUN mkdir -p server/public && cp -r web/dist/* server/public/

# --- Runtime stage ---
FROM node:20-alpine
WORKDIR /app
ENV NODE_ENV=production

# Copy server app & node_modules
COPY --from=build /app/server /app

EXPOSE 8080
CMD ["node", "src/index.js"]

services:
  - name: grok-reply-app
    type: web
    envVars:
      - key: PORT
        value: 8080
      - key: SESSION_SECRET
        generateValue: true
      - key: X_CLIENT_ID
        sync: false
      - key: X_CLIENT_SECRET
        sync: false
      - key: X_REDIRECT_URI
        value: https://${{RAILWAY_PUBLIC_DOMAIN}}/auth/x/callback
      - key: X_SCOPES
        value: tweet.read users.read tweet.write offline.access
      - key: XAI_API_KEY
        sync: false
      - key: XAI_BASE_URL
        value: https://api.x.ai/v1
      - key: XAI_MODEL
        value: grok-4-0709
      - key: XAI_TOKEN_BUDGET_DAILY
        value: 1000000
      - key: WEB_ORIGIN
        value: https://${{RAILWAY_PUBLIC_DOMAIN}}
    healthcheckPath: /auth/me
    autoDeploy: true

# Grok Reply App

Zero-code friendly app to draft and post smart replies on X (Twitter) using Grok‑4.
Single Docker image (Express serves the React build). Ready for Railway.

## Quick Deploy (Railway)
1) Push this folder to a GitHub repo named **grok-reply-app**.
2) In Railway: New Project → Deploy from GitHub → select your repo.
3) Add variables (exact names):
   - PORT=8080
   - SESSION_SECRET=(Generate)
   - X_CLIENT_ID=...
   - X_CLIENT_SECRET=...
   - X_REDIRECT_URI=https://YOUR-APP.up.railway.app/auth/x/callback
   - X_SCOPES=tweet.read users.read tweet.write offline.access
   - XAI_API_KEY=...
   - XAI_BASE_URL=https://api.x.ai/v1
   - XAI_MODEL=grok-4-0709
   - XAI_TOKEN_BUDGET_DAILY=1000000
   - WEB_ORIGIN=https://YOUR-APP.up.railway.app
4) In X Dev Portal: set Callback to https://YOUR-APP.up.railway.app/auth/x/callback; Website URL same.
5) Open your Railway URL → Connect X → paste 20–50 handles/tags → Generate → Post.

## Local Dev
- Requires Node 20+
- Build and run:
  ```bash
  cd web && npm i && npm run build
  cd ../server && npm i && npm run dev
  # Open http://localhost:8080
  ```
- Or Docker:
  ```bash
  docker build -t grok-reply-app .
  docker run --rm -p 8080:8080 --env-file .env grok-reply-app
  ```
